# clusters/my-cluster/infra/loki-stack-release.yaml
apiVersion: helm.toolkit.fluxcd.io/v2beta2
kind: HelmRelease
metadata:
  name: loki-stack
  namespace: monitoring # monitoring ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì— ì„¤ì¹˜
spec:
  interval: 30m
  chart:
    spec:
      chart: loki-stack
      version: "2.10.2"
      sourceRef:
        kind: HelmRepository
        name: grafana
        namespace: flux-system
  install:
    remediation:
      retries: 3
  upgrade:
    remediation:
      retries: 3
  values:
    # ğŸ‘‡ ê·¸ë¼íŒŒë‚˜ì™€ì˜ ìë™ ì—°ë™ ì„¤ì •
    grafana:
      # ìš°ë¦¬ í´ëŸ¬ìŠ¤í„°ì—ëŠ” ì´ë¯¸ kube-prometheus-stackì— ê·¸ë¼íŒŒë‚˜ê°€ ìˆìœ¼ë¯€ë¡œ
      # loki-stackì˜ ê·¸ë¼íŒŒë‚˜ëŠ” ì„¤ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
      enabled: false
      
    # ë¡œí‚¤ ìì› ì„¤ì •
    loki:
      resources:
        requests:
          cpu: 200m
          memory: 256Mi
        limits:
          cpu: 500m
          memory: 512Mi

    # í”„ë¡¬í…Œì¼ ìì› ì„¤ì •
    promtail:
      resources:
        requests:
          cpu: 100m
          memory: 128Mi
        limits:
          cpu: 200m
          memory: 256Mi